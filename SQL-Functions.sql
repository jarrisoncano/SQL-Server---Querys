CREATE DATABASE [activity #12 DB - Jarrison cano, Bryan muñoz]
GO
USE [activity #12 DB - Jarrison cano, Bryan muñoz]
GO

CREATE TABLE ARTICULOS
(
  ID_ARTICULO INT PRIMARY KEY,
  NOM_ARTICULO VARCHAR(20) NOT NULL,
  PRECIO_UNITARIO DECIMAL(10,0) NOT NULL
)
GO

CREATE TABLE CLIENTES
(
  ID_CLIENTE INT PRIMARY KEY,
  NOM_CLIENTE VARCHAR(20) NOT NULL,
  APE_CLIENTE VARCHAR(20),
  EDAD INT NOT NULL,
  CIUDAD VARCHAR(20) NOT NULL
)
GO

CREATE TABLE COMPRA_ART
(
  COD_ART INT FOREIGN KEY REFERENCES ARTICULOS(ID_ARTICULO),
  COD_CLIENTE INT FOREIGN KEY REFERENCES CLIENTES(ID_CLIENTE),
  FECHA_COMPRA DATE NOT NULL,
  CANTIDAD INT NOT NULL
)
GO

INSERT INTO ARTICULOS
VALUES
  (1, 'ARROZ', 1600),
  (2, 'AREPAS', 1200),
  (3, 'ACEITE', 3500),
  (4, 'JABÓN', 2300),
  (5, 'MAIZ', 1400)
GO

INSERT INTO CLIENTES
VALUES
  (101, 'JUAN', 'MARTINEZ', 23, 'MEDELLÍN'),
  (102, 'CAMILA', 'GIRALDO', 18, 'MANIZALES'),
  (103, 'NICOLE', 'OSSA', 37, 'BELLO'),
  (104, 'ANDRES', 'BERRIO', 28, 'MEDELLÍN'),
  (105, 'PABLO', 'CASTAÑO', 15, 'SABANETA')
GO

INSERT INTO COMPRA_ART
VALUES
  (2, 103, '2019/05/12', 2),
  (5, 105, '2021/01/28', 1),
  (4, 104, '2020/03/14', 8),
  (1, 103, '2019/08/23', 4),
  (2, 102, '2021/05/20', 1)
GO


-- EJERCICIO 1
CREATE OR ALTER FUNCTION fn_1(@ID INT)
RETURNS @TABLE TABLE 
  (
  ID_ARTICULO INT ,
  NOM_ARTICULO VARCHAR(20),
  PRECIO_UNITARIO DECIMAL(10,0)
  )
AS 
BEGIN
  INSERT @TABLE
  SELECT ID_ARTICULO, NOM_ARTICULO, PRECIO_UNITARIO
  FROM ARTICULOS A
    INNER JOIN COMPRA_ART CA ON CA.COD_ART = A.ID_ARTICULO
    INNER JOIN CLIENTES C ON C.ID_CLIENTE = CA.COD_CLIENTE
  WHERE C.ID_CLIENTE = @ID
  RETURN
END
GO

SELECT *
FROM fn_1(103)
GO

--EJERCICIO 2
CREATE OR ALTER FUNCTION fn_2(@ID INT)
RETURNS @TABLE TABLE
  (
  NOM_ARTICULO VARCHAR(20),
  NOM_CLIENTE VARCHAR(20),
  FECHA_COMPRA DATE,
  CANTIDAD INT
  )
AS
BEGIN
  INSERT @TABLE
  SELECT NOM_ARTICULO, NOM_CLIENTE, FECHA_COMPRA, CANTIDAD
  FROM COMPRA_ART CA
    INNER JOIN ARTICULOS A ON A.ID_ARTICULO = CA.COD_ART
    INNER JOIN CLIENTES C ON C.ID_CLIENTE = CA.COD_CLIENTE
  WHERE A.ID_ARTICULO = @ID
  RETURN
END
GO

SELECT *
FROM fn_2(2)
GO

--EJERCICIO 3
CREATE OR ALTER FUNCTION fn_3()
RETURNS @TABLE TABLE
  (
  FECHA_COMPRA DATE,
  CANTIDAD INT,
  NOM_CLIENTE VARCHAR(20),
  NOM_ARTICULO VARCHAR(20),
  PRECIO_UNITARIO DECIMAL(10,0)
  )
AS
BEGIN
  INSERT @TABLE
  SELECT FECHA_COMPRA, CANTIDAD, NOM_CLIENTE, NOM_ARTICULO, PRECIO_UNITARIO
  FROM COMPRA_ART CA
    INNER JOIN ARTICULOS A ON A.ID_ARTICULO = CA.COD_ART
    INNER JOIN CLIENTES C ON C.ID_CLIENTE = CA.COD_CLIENTE
  WHERE CANTIDAD > 5
  RETURN
END
GO

SELECT *
FROM fn_3()
GO

--EJERCICIO 4
CREATE OR ALTER FUNCTION fn_4(@FROM DATE, @TO DATE)
RETURNS @TABLE TABLE
  (
  NOM_CLIENTE VARCHAR(20)
  )
AS
BEGIN
  INSERT @TABLE
  SELECT NOM_CLIENTE
  FROM CLIENTES C
    INNER JOIN COMPRA_ART CA ON CA.COD_CLIENTE = C.ID_CLIENTE
  WHERE FECHA_COMPRA BETWEEN @FROM AND @TO
  RETURN
END
GO

SELECT *
FROM fn_4('2021/01/01','2021/06/01')
GO